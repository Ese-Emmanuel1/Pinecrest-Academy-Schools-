<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <title>PineCrest Academy â€” Student Result Portal</title>
  <meta name="description" content="Official PineCrest Academy Result Portal â€” Check your academic performance" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* =============== Pinecrest Global Styles (from main site) =============== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      overflow-x: hidden;
      color: #333;
      background-color: #f5f7fa;
      max-width: 100vw;
    }

    /* =============== Reuse Header & Nav from Main Site =============== */
    header {
      background: rgba(255, 255, 255, 0.98);
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
      position: fixed;
      width: 100%;
      z-index: 1000;
      padding: 12px 5%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 100vw;
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(26, 95, 180, 0.1);
    }
    .logo-container {
      display: flex;
      align-items: center;
    }
    .logo {
      width: 55px;
      height: 55px;
      margin-right: 15px;
      background: linear-gradient(135deg, #1a5fb4 0%, #1c71d8 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 22px;
      font-weight: bold;
      border: 2px solid #fff;
      box-shadow: 0 0 0 2px #1a5fb4;
    }
    .logo-text {
      font-size: 22px;
      font-weight: 700;
      color: #1a5fb4;
      letter-spacing: 0.5px;
    }
    .school-motto {
      font-style: italic;
      color: #1a5fb4;
      font-weight: 600;
      margin-left: 20px;
      padding-left: 20px;
      border-left: 2px solid #1a5fb4;
      text-shadow: 0 0 5px rgba(26, 95, 180, 0.2);
    }
    nav ul {
      display: flex;
      list-style: none;
    }
    nav ul li {
      margin: 0 12px;
      position: relative;
    }
    nav ul li a {
      text-decoration: none;
      color: #444;
      font-weight: 600;
      font-size: 16px;
      transition: color 0.3s;
      padding: 8px 5px;
      position: relative;
    }
    nav ul li a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: #1a5fb4;
      transition: width 0.3s ease;
    }
    nav ul li a:hover::after {
      width: 100%;
    }
    nav ul li a:hover {
      color: #1a5fb4;
    }
    .hamburger {
      display: none;
      flex-direction: column;
      cursor: pointer;
      z-index: 1002;
      padding: 8px;
    }
    .hamburger span {
      width: 28px;
      height: 3px;
      background: #1a5fb4;
      margin: 3px 0;
      border-radius: 2px;
      transition: all 0.3s ease;
    }

    /* =============== Mobile Nav Drawer (from main site) =============== */
    .overlay-nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: none;
    }
    .mobile-nav {
      position: fixed;
      top: 0;
      right: -300px;
      width: 300px;
      height: 100vh;
      background: white;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
      z-index: 1001;
      transition: right 0.3s ease-in-out;
      padding: 60px 20px 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .mobile-nav.active {
      right: 0;
    }
    .close-nav {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #1a5fb4;
      background: rgba(26, 95, 180, 0.1);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .mobile-nav ul {
      list-style: none;
      margin-top: 20px;
    }
    .mobile-nav ul li {
      margin-bottom: 10px;
    }
    .mobile-nav ul li a {
      display: block;
      padding: 15px;
      color: #333;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .mobile-nav ul li a:hover {
      background-color: #f0f7ff;
      color: #1a5fb4;
    }
    .mobile-nav-header {
      padding: 15px 0;
      border-bottom: 1px solid #eee;
      margin-bottom: 15px;
    }

    /* =============== Main Content =============== */
    .main-wrapper {
      padding-top: 100px;
      padding-bottom: 80px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    .page-header {
      text-align: center;
      margin-bottom: 40px;
    }
    .page-header h1 {
      font-family: 'Playfair Display', serif;
      font-size: 28px;
      color: #1a5fb4;
      margin-bottom: 12px;
    }
    .page-header p {
      color: #666;
      font-size: 16px;
    }

    /* =============== Result Checker Styles (Pinecrest-themed) =============== */
    .result-shell {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(26, 95, 180, 0.1);
      overflow: hidden;
      border: 1px solid #eaeff5;
      max-width: 800px;
      margin: 0 auto;
    }
    .form-body {
      padding: 30px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin: 0 0 8px;
      font-weight: 600;
      color: #1a5fb4;
      font-size: 15px;
    }
    
    input, select {
      width: 100%;
      padding: 14px;
      border: 1px solid #d1d9e6;
      border-radius: 12px;
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      background: #fafbff;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #1a5fb4;
      background: white;
    }

    .btn {
      padding: 14px 24px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s ease;
      border: none;
      width: 100%;
      margin-top: 20px;
    }
    .btn-primary {
      background: linear-gradient(135deg, #1a5fb4, #1c71d8);
      color: white;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(26, 95, 180, 0.3);
    }

    #status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
      display: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    #status.success {
      background-color: #e8f5e9;
      color: #2e7d32;
      display: block;
    }
    #status.error {
      background-color: #ffebee;
      color: #c62828;
      display: block;
    }
    #status.loading {
      background-color: #e3f2fd;
      color: #1565c0;
      display: block;
    }

    /* =============== Result Display Section =============== */
    .result-display {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(26, 95, 180, 0.1);
      padding: 30px;
      margin-top: 30px;
      display: none;
    }
    
    .result-summary {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .result-item {
      background: #f0f7ff;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      border: 1px solid #d1e3ff;
    }
    
    .result-value {
      font-size: 28px;
      font-weight: 800;
      color: #1a5fb4;
      margin-bottom: 5px;
    }
    
    .result-label {
      font-size: 14px;
      color: #555;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .result-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }
    
    .btn-view-report {
      background: linear-gradient(135deg, #2ecc71, #27ae60);
      color: white;
    }
    
    .btn-view-report:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(46, 204, 113, 0.3);
    }
    
    /* Mobile Nav Responsive */
    @media (max-width: 992px) {
      .school-motto { display: none; }
      .result-summary {
        grid-template-columns: repeat(2, 1fr);
      }
      .result-actions {
        flex-direction: column;
      }
    }
    
    @media (max-width: 768px) {
      header { padding: 12px 15px; }
      .hamburger { display: flex; margin-left: auto; }
      nav { display: none; }
      .main-wrapper { padding-top: 100px; }
      .result-shell { margin: 0 15px; }
    }
  </style>
</head>
<body>
  <!-- === EXACT SAME HEADER & NAV FROM MAIN SITE === -->
  <div class="overlay-nav" id="overlayNav"></div>
  <div class="mobile-nav" id="mobileNav">
    <div class="close-nav" id="closeNav">&times;</div>
    <div class="mobile-nav-header">
      <div class="logo-container">
        <div class="logo">PA</div>
        <div class="logo-text">Pinecrest Academy</div>
      </div>
    </div>
    <ul>
      <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
      <li><a href="about.html"><i class="fas fa-info-circle"></i> About</a></li>
      <li><a href="academics.html"><i class="fas fa-book"></i> Academics</a></li>
      <li><a href="admission.html"><i class="fas fa-user-graduate"></i> Admissions</a></li>
      <li><a href="resultchecker.html" class="active"><i class="fas fa-check-circle"></i> Check Result</a></li>
      <li><a href="sport.html"><i class="fas fa-basketball-ball"></i> Sports</a></li>
      <li><a href="news.html"><i class="fas fa-newspaper"></i> News</a></li>
      <li><a href="contact_us.html"><i class="fas fa-envelope"></i> Contact</a></li>
      <li><a href="gallery.html"><i class="fas fa-book-open"></i> Gallery</a></li>
    </ul>
  </div>

  <header>
    <div class="logo-container">
      <div class="logo">PA</div>
      <div class="logo-text">Pinecrest Academy</div>
      <div class="school-motto">Excellence Through Knowledge & Character</div>
    </div>
    <div class="hamburger" id="hamburger-menu">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="academics.html">Academics</a></li>
        <li><a href="admission.html">Admissions</a></li>
        <li><a href="resultchecker.html">Check Result</a></li>
        <li><a href="sport.html">Sports</a></li>
        <li><a href="news.html">News</a></li>
        <li><a href="contact_us.html">Contact</a></li>
        <li><a href="gallery.html">Gallery</a></li>
      </ul>
    </nav>
  </header>

  <!-- === RESULT CHECKER CONTENT === -->
  <div class="main-wrapper">
    <div class="container">
      <div class="page-header">
        <h1>Student Result Portal</h1>
        <p>Enter your credentials to view your report card</p>
      </div>

      <div class="result-shell">
        <div class="form-body">
          <div class="form-group">
            <label for="studentId">Student ID</label>
            <input type="text" id="studentId" placeholder="Enter your Student ID (e.g., SE0001MEC)" />
          </div>
          
          <div class="form-group">
            <label for="pin">PIN</label>
            <input type="password" id="pin" placeholder="Enter your PIN" />
          </div>
          
          <div class="form-group">
            <label for="term">Term</label>
            <select id="term">
              <option value="">Select Term</option>
              <option value="1">First Term</option>
              <option value="2">Second Term</option>
              <option value="3">Third Term</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="year">Year</label>
            <select id="year">
              <option value="">Select Year</option>
              <option value="2024">2024</option>
              <option value="2025">2025</option>
              <option value="2026">2026</option>
              <option value="2027">2027</option>
            </select>
          </div>
          
          <button class="btn btn-primary" id="checkBtn">
            <i class="fas fa-check-circle"></i> Check My Result
          </button>
          
          <div id="status"></div>
        </div>
      </div>

      <!-- Result Summary Display -->
      <div class="result-display" id="resultDisplay">
        <div class="page-header">
          <h2>Result Summary</h2>
          <p>Overview of your academic performance</p>
        </div>
        
        <div class="result-summary">
          <div class="result-item">
            <div class="result-value" id="displayTotalSubjects">0</div>
            <div class="result-label">Total Subjects</div>
          </div>
          <div class="result-item">
            <div class="result-value" id="displaySubjectsTaken">0</div>
            <div class="result-label">Subjects Taken</div>
          </div>
          <div class="result-item">
            <div class="result-value" id="displayFailedSubjects">0</div>
            <div class="result-label">Failed Subjects</div>
          </div>
          <div class="result-item">
            <div class="result-value" id="displayClassPosition">-</div>
            <div class="result-label">Class Position</div>
          </div>
        </div>
        
        <div style="text-align: center;">
          <h3>Ready to view your detailed academic report?</h3>
          <p>Click the button below to see your full report card with detailed subject breakdown</p>
          
          <div class="result-actions">
            <button class="btn btn-view-report" id="viewReportBtn">
              <i class="fas fa-file-alt"></i> View Full Academic Report
            </button>
            <button class="btn btn-primary" onclick="window.location.href='academic-report.html'">
              <i class="fas fa-graduation-cap"></i> Go to Report Page
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- === Scripts: Mobile Nav + Supabase + Result Logic === -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    const SUPABASE_URL = 'https://efiruwfplizcbrtgaajs.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmaXJ1d2ZwbGl6Y2JydGdhYWpzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5ODc1MTUsImV4cCI6MjA3MjU2MzUxNX0.k9FSDDvsEVaqYgNKZLSQcDaJUj8ISsDnAlQ3S8gUbeE';

    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    // Subject structures for different tables
    const tableSubjectStructures = {
      'jss1': [
        { name: 'MATHEMATICS', ca1: 'maths', ca2: 'maths2', exam: 'maths3' },
        { name: 'ENGLISH LANGUAGE', ca1: 'english', ca2: 'english2', exam: 'english3' },
        { name: 'CIVIC EDUCATION', ca1: 'civic', ca2: 'civic2', exam: 'civic3' },
        { name: 'CHRISTIAN RELIGIOUS STUDIES', ca1: 'crs', ca2: 'crs2', exam: 'crs3' },
        { name: 'SOCIAL STUDIES', ca1: 'social_studies', ca2: 'social_studies2', exam: 'social_studies3' },
        { name: 'HOME ECONOMICS', ca1: 'home_economic', ca2: 'home_economic2', exam: 'home_economic3' },
        { name: 'AGRICULTURAL SCIENCE', ca1: 'agric', ca2: 'agric2', exam: 'agric3' }
      ],
      'sss1': [
        { name: 'MATHEMATICS', ca1: 'maths', ca2: 'maths2', exam: 'maths3' },
        { name: 'ENGLISH LANGUAGE', ca1: 'english', ca2: 'english2', exam: 'english3' },
        { name: 'CIVIC EDUCATION', ca1: 'civic', ca2: 'civic2', exam: 'civic3' },
        { name: 'CHRISTIAN RELIGIOUS STUDIES', ca1: 'crs', ca2: 'crs2', exam: 'crs3' },
        { name: 'ECONOMICS', ca1: 'economics', ca2: 'economics2', exam: 'economics3' },
        { name: 'GOVERNMENT', ca1: 'government', ca2: 'government2', exam: 'government3' },
        { name: 'AGRICULTURAL SCIENCE', ca1: 'agric', ca2: 'agric2', exam: 'agric3' },
        { name: 'BIOLOGY', ca1: 'biology', ca2: 'biology2', exam: 'biology3' }
      ]
    };

    // === Mobile Nav Toggle (from main site) ===
    const hamburger = document.getElementById('hamburger-menu');
    const mobileNav = document.getElementById('mobileNav');
    const closeNav = document.getElementById('closeNav');
    const overlayNav = document.getElementById('overlayNav');

    hamburger.addEventListener('click', () => {
      mobileNav.classList.add('active');
      overlayNav.style.display = 'block';
      document.body.style.overflow = 'hidden';
    });
    
    [closeNav, overlayNav].forEach(el => {
      el.addEventListener('click', () => {
        mobileNav.classList.remove('active');
        overlayNav.style.display = 'none';
        document.body.style.overflow = 'auto';
      });
    });

    // === Result Checker Logic ===
    window.addEventListener('DOMContentLoaded', () => {
      const checkBtn = document.getElementById('checkBtn');
      const status = document.getElementById('status');
      const resultDisplay = document.getElementById('resultDisplay');
      const viewReportBtn = document.getElementById('viewReportBtn');
      
      let currentStudentData = null;
      let currentTableName = '';

      checkBtn.addEventListener('click', async () => {
        // Reset UI
        status.textContent = '';
        status.className = '';
        resultDisplay.style.display = 'none';

        // Get form values
        const studentId = document.getElementById('studentId').value.trim();
        const pin = document.getElementById('pin').value.trim();
        const term = document.getElementById('term').value;
        const year = document.getElementById('year').value;

        // Validation
        if (!studentId || !pin || !term || !year) {
          status.textContent = 'âš ï¸ Please fill in all fields.';
          status.className = 'error';
          return;
        }

        status.textContent = 'ðŸ”Ž Searching for your academic record...';
        status.className = 'loading';

        try {
          let studentData = null;
          let tableName = '';
          
          // Search in both tables
          const tables = ['jss1', 'sss1'];
          
          for (const table of tables) {
            const { data, error } = await supabase
              .from(table)
              .select('*')
              .eq('id', studentId)
              .eq('pin', pin)
              .eq('term', term)
              .eq('year', year)
              .maybeSingle();

            if (error) {
              console.error(`${table} query error:`, error);
              continue;
            }

            if (data) {
              studentData = data;
              tableName = table;
              break;
            }
          }
          
          if (!studentData) {
            status.textContent = 'âŒ No academic record found for the provided credentials.';
            status.className = 'error';
            return;
          }

          // Save data for report generation
          currentStudentData = studentData;
          currentTableName = tableName;

          // Display success
          status.textContent = `âœ… Academic record found!`;
          status.className = 'success';

          // Calculate and display result summary
          displayResultSummary(studentData, tableName);
          
          // Show result display section
          setTimeout(() => {
            resultDisplay.style.display = 'block';
            resultDisplay.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 500);
          
        } catch (err) {
          console.error('Error fetching data:', err);
          status.textContent = 'âŒ Error: ' + (err.message || 'Failed to fetch academic record');
          status.className = 'error';
        }
      });

      function displayResultSummary(studentData, tableName) {
        const subjectStructure = tableSubjectStructures[tableName] || tableSubjectStructures['jss1'];
        
        let totalSubjects = subjectStructure.length;
        let subjectsTaken = 0;
        let failedSubjects = 0;
        
        // Calculate summary statistics
        subjectStructure.forEach((subject) => {
          const firstTest = parseInt(studentData[subject.ca1]) || 0;
          const secondTest = parseInt(studentData[subject.ca2]) || 0;
          const exam = parseInt(studentData[subject.exam]) || 0;
          const subjectTotal = firstTest + secondTest + exam;
          const subjectGrade = calculateGrade(subjectTotal);
          
          if (firstTest > 0 || secondTest > 0 || exam > 0) {
            subjectsTaken++;
            if (subjectGrade === 'F') {
              failedSubjects++;
            }
          }
        });

        // Update display elements
        document.getElementById('displayTotalSubjects').textContent = totalSubjects;
        document.getElementById('displaySubjectsTaken').textContent = subjectsTaken;
        document.getElementById('displayFailedSubjects').textContent = failedSubjects;
        document.getElementById('displayClassPosition').textContent = 'N/A'; // Can be updated if position data exists
      }

      function calculateGrade(score) {
        if (score >= 75) return 'A';
        if (score >= 70) return 'B';
        if (score >= 65) return 'C';
        if (score >= 60) return 'D';
        if (score >= 50) return 'E';
        if (score >= 40) return 'F';
        return 'F';
      }

      function getTermName(termNumber) {
        const terms = {
          '1': 'First Term',
          '2': 'Second Term',
          '3': 'Third Term'
        };
        return terms[termNumber] || termNumber;
      }

      // View Report Button click handler
      viewReportBtn.addEventListener('click', () => {
        if (currentStudentData && currentTableName) {
          // Save data to localStorage for the report page
          localStorage.setItem('studentReportData', JSON.stringify(currentStudentData));
          localStorage.setItem('studentTableName', currentTableName);
          
          // Redirect to academic report page
          window.location.href = 'academic-report.html';
        } else {
          alert('Please check your result first before viewing the report.');
        }
      });

      // Set current year as default
      const currentYear = new Date().getFullYear();
      const yearSelect = document.getElementById('year');
      const currentYearOption = yearSelect.querySelector(`option[value="${currentYear}"]`);
      if (currentYearOption) {
        currentYearOption.selected = true;
      }
    });
  </script>
</body>
</html>


